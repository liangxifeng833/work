@startuml
title 爆款商品-预定-状态图

[*] --> 未核销: 有无门槛预定
未核销: 客户预定爆款商品\n预定表状态默认=未核销\n有无门槛均可预定\n并以unionid区分用户
未核销 --> 已核销: 顾客小程序扫码

[*] --> 未付款: 有门槛预定
 未付款: 爆款商品与合同关系表入数据
 未付款: 付款状态pay_status = 未付款
 
 [*] --> 未确认: 有门槛预定
 未确认: 爆款商品与合同关系表入数据
  未确认: 扣款状态reduce_status = 未确认
  未确认 --> 已确认: 商户确认
  已确认: 对账系统确认对账单的同时\n确认门槛合同状态reduce_status=已确认
已确认 --> 已扣款: 财务人员返款
已扣款: 财务人员返款的时候\n在mis系统点击扣款\n修改爆款商品与合同关系表reduce_status = 已扣款

 已核销 : 顾客小程序扫一扫下单系统二维码 
 已核销 : 通过unionid和主键更新预定记录表核销\n状态check_status=已核销

 未付款 -> 已付款: 下单系统下单成功后
已付款: 下单成功生成合同号后
已付款: 手动调用after_order钩子
已付款: 钩子中调用顾客小程序应用层
已付款: 根据手机号,合同额,核销状态=已核销
已付款: 更新预定表爆款商品合同号字段
已付款: 修改合同与爆款商品关系表pay_status=已付款
已付款: 应用层错误日志：/logs/hot_product/hotBindContract_云编号.log

已付款 --> 已退款
已退款: 财务人员冲红记录\n将正向合同与爆款商品关系表数据\npay_status字段修改为已退款
已付款 --> 已冲红
已冲红: 财务人员冲红记录\n将逆向合同与爆款商品关系表数据\npay_status字段新增为已冲红


@enduml