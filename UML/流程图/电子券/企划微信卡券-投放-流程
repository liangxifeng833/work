@startuml
title 企划微信卡券--投放-流程

	
|促销平台|	
:选择要投放的卡券;
|微信卡券领域层|
:投放成功\n本地卡券状态＝已投放;

|公众号后台|
:关闭开发者配置;
:配置自定义菜单;
:将投放卡券页面\n作为链接方式\n关联自定义菜单;
note right:注意：\n不要停用自定义菜单

|促销平台|
:同步自定义菜单;
note left: 先拉取后创建

|微信公众号|
:点击自定义菜单\n优惠券中心链接;
:点击领取卡券;
:卡券js-sdk方式\n驱动添加卡券接口;
:用户领取;

|微信server|
:领取事件;

|微信卡券领域层|
:接收领取事件;
:根据code码修改本地电子券\n状态＝已发放\nunionid=领取人unionid\n修改本地库存-1\n<font color=red>注意：转增后领取事件没有unionid;

|收银系统|	
	:用券;
|微信卡券领域层|
   :核销电子券;	
	
end
@enduml
