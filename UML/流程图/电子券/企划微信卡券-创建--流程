@startuml
title 企划微信卡券创建-流程


|券平台|
start
: 预制原始制券;
:将批次与券绑定;
	note left
		填写用券规则
		与微信卡券结合，
		必须使用连续日期
		黑白名单设置
	end note
	
|促销平台|	
:创建微信卡券\n自定义code;
note 
	1, 关联未开始的促销活动
	2, 关联未开始的券批次，
	（连续有效期的）
end note
|微信卡券领域层|
:创建成功\n本地数据库状态＝未审核;

|微信server|
:审核事件;

|微信卡券领域层|
:接收审核事件;
:修改本地数据库\n卡券状态＝审核通过\n或审核失败;

|促销平台|	
	:导入电子券;
|微信卡券领域层|
	:批量生成使用码;
	:请求微信导入自定义code;

|促销平台|
:补充电子券;
note left:本地数据库补充
:减少库存;
note left:减少微信端库存\n减少本地库存
:修改卡券;
note left:未开始之前可修改\n修改微信端\n修改本地数据库
:删除卡券;
note left:删除微信卡券\n本地修改状态为已删除
end
@enduml
